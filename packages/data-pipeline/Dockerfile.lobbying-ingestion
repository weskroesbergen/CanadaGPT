FROM python:3.11-slim

WORKDIR /app

# Install dependencies
COPY packages/data-pipeline/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the pipeline code
COPY packages/data-pipeline/fedmcp_pipeline/ ./fedmcp_pipeline/

# Copy the FedMCP package (for LobbyingRegistryClient)
COPY packages/fedmcp/src/fedmcp/ ./fedmcp/

# Copy the entrypoint script
COPY packages/data-pipeline/run_lobbying_ingestion.py .

# Run as non-root user
RUN useradd -m -u 1000 appuser && chown -R appuser:appuser /app
USER appuser

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV PYTHONPATH=/app

CMD ["python", "run_lobbying_ingestion.py"]
